<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Application Architecture - QuAntiL</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../../../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Application Architecture";
        var mkdocs_page_input_path = "developer-guide/qc-atlas/application-architecture.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> QuAntiL
        </a>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../docker/">Quickstart</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">User Guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../user-guide/qc-atlas/">QC Atlas</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../user-guide/qverview/">Qverview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../user-guide/qhana/">QHAna</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../user-guide/qhana-new/">QHAna (new)</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../user-guide/circuit-transformer/">Circuit Transformer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../user-guide/nisq-analyzer/">NISQ Analyzer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../user-guide/quantme/">QuantME</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../user-guide/qprov/">QProv</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../user-guide/planqk-library/">PlanQK Library</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Developer Guide</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../../intellij/">IntelliJ Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../openapi/">OpenAPI</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Application Architecture</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#implementation-rulesguidelines">Implementation rules/guidelines</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#general">General</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#controllers">Controllers</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#dto-validation">DTO Validation</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#services">Services</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#repositories">Repositories</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#database-model-classes">Database Model Classes</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../testing/">Testing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../db-migrations/">Database migrations</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">QuAntiL</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Developer Guide &raquo;</li>
      <li>Application Architecture</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/UST-QuAntiL/quantil-docs/tree/master/docs/developer-guide/qc-atlas/application-architecture.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="application-architecture">Application Architecture</h1>
<h2 id="implementation-rulesguidelines">Implementation rules/guidelines</h2>
<p>The operations we have implemented in the three layers follow the following basic rules.
Some of the criterea listed below are used to build tests, e.g. throwing an Exception if an object is not found.</p>
<h3 id="general">General</h3>
<ul>
<li>Loggers shall be retrieved using the <code>@Slf4j</code> class annotation from lombok</li>
<li>Contructors of Components (Services, Repositories, Controllers...) shall be created using the <code>@AllArgsConstructor</code> class annoation</li>
<li>Attributes of a Component class shall be final</li>
</ul>
<h3 id="controllers">Controllers</h3>
<ul>
<li>If a requested resource is not found, the application has to respond with HTTP 404<ul>
<li>This is mostly done by catching the NoSuchElementException thrown by the services</li>
</ul>
</li>
<li>Validation is Done using Validation groups and the <code>@Validated</code> annotation. There are three:<ul>
<li><code>Create</code>: Used for requirements in a Dto that must be valid during object creation</li>
<li><code>Update</code>: Used for requirements in a Dto that must be valid during object Update</li>
<li><code>IDOnly</code>: Used for parts where only an id is needed, like creating a reference, In the commented Dto Class below, one can observe the use of these three classes.</li>
</ul>
</li>
<li>If the validation fails HTTP 400 is returned including a detailed error message, why the validation failed</li>
<li>If an object cannot be deleted, e.g. if it is still referenced somewhere, HTTP 404 is returned, usualy by the services throwing an EntityReferenceViolationException.</li>
<li>Exposed Controller methods should have a meaningful name, to prevent collisions in OpenAPI.<ul>
<li>For example: <code>getImplementationsOfAlgorithm</code> instead of <code>getImplementations</code> or <code>getPublicationsOfImplementation</code> instead of <code>getPublications</code></li>
</ul>
</li>
<li>Try/catch in controller methods shall be avoided, instead either generic exception handlers in the <code>AtlasExceptionHandler</code> or controller specific exception handles shall be used.</li>
</ul>
<h4 id="dto-validation">DTO Validation</h4>
<pre><code class="language-java">@Data
@EqualsAndHashCode
@ToString
@NoArgsConstructor
@Relation(itemRelation = &quot;computeResourceProperty&quot;, collectionRelation = &quot;computeResourceProperties&quot;)
public class ComputeResourcePropertyDto implements Identifyable {
    // Ensures the ID is not null if the IDOnly class is set as a validation class
    @NotNull(groups = {ValidationGroups.IDOnly.class}, message = &quot;An id is required to perform an update&quot;)
    // Ensures an id is not set when during creation
    @Null(groups = {ValidationGroups.Create.class}, message = &quot;The id must be null for creating a compute resource property&quot;)
    private UUID id;

    private String value;

    // Naming multiple validation classes ensures these conditions are applied to all applications
    // RequiresID is a custom validator to ensure the child type object contains an ID that is not null
    @RequiresID(groups = {ValidationGroups.Update.class, ValidationGroups.Create.class},
            message = &quot;ComputeResourceProperties must have a type with an ID!&quot;)
    @NotNull(groups = {ValidationGroups.Update.class, ValidationGroups.Create.class})
    private ComputeResourcePropertyTypeDto type;
}
</code></pre>
<h3 id="services">Services</h3>
<p>Service methods / classes should follow the following guidelines:</p>
<ul>
<li>A method, performing write access to the database should be annotated with <code>@Transactional</code></li>
<li>Services should be separated in an interface describing the methods exposed to the Controllers and other services and an Implementation class that implements the service methods.</li>
<li>To check if an object exists the <code>exists</code> method of a repository shall be used</li>
<li>If an object does not exist, or an object does not exist in the requested relationship a <code>NoSuchElementException</code> shall be thrown</li>
<li>If an object cannot be deleted, e.g. because it is still referenced by another object a EntityReferenceViolationException should be thrown.</li>
<li>Exposed methods should have a meaningful name</li>
<li>Linking two objects like, Implementation and SoftwarePlatform shall be done in the LinkingService</li>
<li>JEE Objects, e.g. <code>HttpServletRequest</code> or <code>MultipartFile</code> shall not be passed into the Services, instead the controllers must pre- or postprocess the data into or from Generic data types, like <code>byte[]</code>, <code>InputStream</code> or <code>OutputStream</code>.</li>
<li>To reduce duplicates and circular dependencies, generic methods from the <code>ServiceUtils</code> class shall be used.<ul>
<li>If it is possible to derive a new Method for this class, because something is used in multiple serivies such a method shall be externailzed.</li>
</ul>
</li>
</ul>
<h3 id="repositories">Repositories</h3>
<p>Repository interfaces, for JPA should follow the following guidelines:</p>
<ul>
<li>Native queries should be avoided</li>
<li>Use Method based queries where possible<ul>
<li>The use of JQL (using the <code>@Query</code> annotation) should only be done if mandatory</li>
</ul>
</li>
<li>Lists should return <code>Page&lt;T&gt;</code> objects and take <code>Pageable</code>s as a input parameter</li>
<li>In case of single elements <code>Optional</code>s should be used</li>
<li>To check if something exists a <code>exists</code> method, e.g. <code>existsById</code>, should be used.</li>
</ul>
<h3 id="database-model-classes">Database Model Classes</h3>
<ul>
<li>Sets shall be used as lists where possible to elliminate potential double references</li>
<li>Lombok shall be used to generate Constructors </li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../openapi/" class="btn btn-neutral float-left" title="OpenAPI"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../testing/" class="btn btn-neutral float-right" title="Testing">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/UST-QuAntiL/quantil-docs" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../../openapi/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../testing/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme_extra.js" defer></script>
    <script src="../../../js/theme.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
